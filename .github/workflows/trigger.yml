name: Trigger Repos

on:
  push:
    branches: test-ci
    
jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

#    - name: Push to tinyusb_src
#      uses: cpina/github-action-push-to-another-repository@master
#      env:
#        API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
#      with:
#        source-directory: 'src'
#        destination-github-username: 'hathach'
#        destination-repository-name: 'tinyusb_src'
#        target-branch: 'main'
#        user-email: thach@tinyusb.org

    - name: Push to tinyusb_src
      uses: johno/actions-push-subdirectories@master
      env:
        API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        args: src hathach tinyusb_src

    - name: Trigger mynewt-tinyusb-example
      shell: bash
      run: |
        curl -X POST -H "Authorization: token ${{ secrets.API_TOKEN_GITHUB }}" -H "Accept: application/vnd.github.everest-preview+json" -H "Content-Type: application/json" --data '{"event_type": "rebuild"}' https://api.github.com/repos/hathach/mynewt-tinyusb-example/dispatches